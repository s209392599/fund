<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>涨幅速览</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    #imgbox {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }

    img {
      display: block;
      border: 1px solid #ddd;
      margin: 2px;
      height: 160px;
      width: calc(50% - 4px);
    }

    @media (min-width: 1440px) {
      img {
        width: calc(33.33% - 4px);
      }
    }

    @media (min-width: 1920px) {
      img {
        width: calc(25% - 4px);
      }
    }

    .color-red {
      color: red;
    }

    .color-green {
      color: #090;
    }
  </style>
</head>

<body>
  <div id="imgbox"></div>
  <!-- 量化 -->
  <div id="lianghua_box" style="padding: 10px 10px 20px 10px;"></div>

  <script>
    /*
    { code: '018561', name: '中信保诚多策略C' },// 100
    { code: '020726', name: '建信灵活配置混合C' },// 50
    { code: '016858', name: '国金量化多因子股票C' },// 50
    { code: '018729', name: '华夏智胜新锐股票C' },// 50
    { code: '023350', name: '诺安多策略混合C' },// 50

    { code: '007467', name: '华泰柏瑞中证红利低波ETF联接C' },// 30
    { code: '023918', name: '华夏国证自由现金流ETF发起式联接C' },// 30
    { code: '019260', name: '富国恒生红利ETF联接A' },// 30
    { code: '008164', name: '南方红利低波50ETF联接C'}// 30

    */
    fetch('http://150.158.175.108:9999/fund_public_fund').then(res => res.json()).then(res => {
      console.log('res', res);
      let arr_1 = res.data || [];
      let arr_2 = [];// 常规的
      let arr_3 = [];// 需要服务器监听的

      arr_1.forEach(item => {
        if (item.zhang_url === '服务器监听') {
          arr_3.push(item)
        } else if (!['不提供'].includes(item.zhang_url)) {
          arr_2.push(item)
        }
      })

      render_1(arr_2);
      render_2(arr_3);
    }).catch(err => {
      console.log('err', err);
    })

    // 常规的
    function render_1(arr) {
      let html = arr
        .map(
          (item) => {
            let altstr = item.name || item.code;
            if (!item.zhang_url) {
              return `<img src="https://j4.dfcfw.com/charts/pic6/${item.code}.png" alt="${altstr}">`
            } else {
              return `<img src="${item.zhang_url}" alt="${altstr}">`
            }
          }
        )
        .join('');
      document.getElementById('imgbox').innerHTML = html;
    }

    // 需要服务器监听的
    function render_2(arr) {
      arr.forEach(item => {
        let htmlString = `<div>${item.name}(${item.code})</div><div id="id_${item.code}_1"></div>`;
        let tempDiv = document.createElement('div');
        tempDiv.className = 'lianghua_line';
        tempDiv.innerHTML = htmlString;
        document.getElementById('lianghua_box').appendChild(tempDiv);

        const script = document.createElement('script');
        script.src = `https://fundgz.1234567.com.cn/js/${item.code}.js`;
        document.body.appendChild(script);
      })
    }

    function jsonpgz(data) {
      let zhang_class = '';
      if (Number(data.gszzl) > 0) zhang_class = 'color-red';
      if (Number(data.gszzl) < 0) zhang_class = 'color-green';
      document.getElementById('id_' + data.fundcode + '_1').innerHTML = `${data.dwjz} ${data.gsz} <span class="${zhang_class}">${data.gszzl}</span> ${data.gztime}`;
    }



  </script>
</body>

</html>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>涨幅速览</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    #imgbox {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }

    .type_1 {
      display: block;
      border: 1px solid #ddd;
      margin: 2px;
      height: 120px;
      width: calc(50% - 4px);
    }

    .type_1 img {
      width: 100%;
      height: 100%;
    }

    @media (min-width: 1440px) {
      .type_1 {
        width: calc(33.33% - 4px);
        height: 140px;
      }
    }

    @media (min-width: 1920px) {
      .type_1 {
        width: calc(25% - 4px);
        height: 160px;
      }
    }

    .lianghua_line {
      padding: 5px 0;
    }

    .color-red {
      color: red;
    }

    .color-green {
      color: #090;
    }
  </style>
</head>

<body>
  <div id="imgbox"></div>

  <!-- 量化 -->
  <div id="lianghua_box" style="padding: 10px 10px 20px 10px;"></div>

  <script>
    fetch('http://150.158.175.108:9999/fund_public_fund').then(res => res.json()).then(res => {
      console.log('res', res);
      let arr_1 = res.data || [];
      let arr_2 = [];// 常规的
      let arr_3 = [];// 需要服务器监听的

      arr_1.forEach(item => {
        if (item.zhang_url === '服务器监听') {
          arr_3.push(item)
        } else if (!['不提供'].includes(item.zhang_url)) {
          arr_2.push(item)
        }
      })

      render_1(arr_2);
      render_2(arr_3);
      render_2(arr_2, { split: true });
    }).catch(err => {
      console.log('err', err);
    })

    // 常规的
    function render_1(arr) {
      let html = arr
        .map(
          (item) => {
            let altstr = item.name || item.code;
            if (!item.zhang_url) {
              return `<a class="type_1" href="https://fund.eastmoney.com/${item.code}.html" target="_blank"><img src="https://j4.dfcfw.com/charts/pic6/${item.code}.png" alt="${altstr}" /></a>`
            } else {
              return `<a class="type_1" href="https://fund.eastmoney.com/${item.code}.html" target="_blank"><img src="${item.zhang_url}" alt="${altstr}"></a>`
            }
          }
        )
        .join('');
      document.getElementById('imgbox').innerHTML = html;
    }

    // 需要服务器监听的
    function render_2(arr, options) {
      if (!!(options || {}).split) {
        let tempDiv = document.createElement('hr');
        document.getElementById('lianghua_box').appendChild(tempDiv); '';
      }
      arr.forEach((item, index) => {
        let htmlString = `<div>${item.name}(${item.code})</div><div id="id_${item.code}_1"></div>`;
        let tempDiv = document.createElement('div');
        tempDiv.className = 'lianghua_line';
        tempDiv.innerHTML = htmlString;
        document.getElementById('lianghua_box').appendChild(tempDiv);

        setTimeout(() => {
          const script = document.createElement('script');
          script.src = `https://fundgz.1234567.com.cn/js/${item.code}.js`;
          document.body.appendChild(script);
        }, index * 10)
      })
    }

    // 获取历史数据
    function getHistoryPerformance(fundcode) {
      if (fundcode == '023350') {
        console.log('getHistoryPerformance', fundcode);
      }

      fetch('http://150.158.175.108:9999/fund_history_performance', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          fundcode: fundcode,
        })
      }).then(res => res.json()).then(res => {
        if (res.code === 200) {
          let html = '';

          for (let i = 0; i < res.data.length; i++) {
            let item = res.data[i];
            if ([null, undefined, ''].includes(item.rate)) {
              continue;
            }

            let zhang_class = '';
            if (Number(item.rate) >= 0) zhang_class = 'color-red';
            if (Number(item.rate) < 0) zhang_class = 'color-green';

            if (i === 0) {
              html += ' ' + `周(<span class="${zhang_class}">${item.rate}</span>)`;
            } else if (i === 1) {
              html += ' ' + `月(<span class="${zhang_class}">${item.rate}</span>)`;
            } else if (i === 2) {
              html += ' ' + `3月(<span class="${zhang_class}">${item.rate}</span>)`;
            } else if (i === 3) {
              html += ' ' + `6月(<span class="${zhang_class}">${item.rate}</span>)`;
            } else if (i === 4) {
              html += ' ' + `1年(<span class="${zhang_class}">${item.rate}</span>)`;
            } else if (i === 5) {
              html += ' ' + `3年(<span class="${zhang_class}">${item.rate}</span>)`;
            } else if (i === 6) {
              html += ' ' + `5年(<span class="${zhang_class}">${item.rate}</span>)`;
            } else if (i === 7) {
              html += ' ' + `今年(<span class="${zhang_class}">${item.rate}</span>)`;
            } else if (i === 8) {
              html += ' ' + `成立(<span class="${zhang_class}">${item.rate}</span>)`;
            }
          }
          document.getElementById('his_' + fundcode).innerHTML = html;
        }

      }).catch(err => {
        console.log('err', err);
      })
    }

    function jsonpgz(data) {
      /*
        {
          "fundcode": "002834",
          "name": "华夏新锦绣混合C",
          "jzrq": "2025-08-12",
          "dwjz": "2.7597",
          "gsz": "2.7728",
          "gszzl": "0.48",
          "gztime": "2025-08-13 15:00"
        }
      */
      let zhang_class = '';
      if (Number(data.gszzl) >= 0) zhang_class = 'color-red';
      if (Number(data.gszzl) < 0) zhang_class = 'color-green';
      let timeArr = (data.gztime || '').split('-');
      let curTime = timeArr[1] + '-' + timeArr[2];

      let html = '';
      html += data.dwjz;// 前一日净值
      html += ' ' + curTime;// 最新净值更新时间
      html += ' ' + `今日(<span class="${zhang_class}">${data.gszzl}</span>)`;// 最新净值涨幅 正数是红色，负数是绿色
      html += ' ' + `<span id="his_${data.fundcode}"></span>`;// 历史表现留的插槽

      document.getElementById('id_' + data.fundcode + '_1').innerHTML = html;
      getHistoryPerformance(data.fundcode);// 获取历史表现数据
    }
  </script>
</body>

</html>